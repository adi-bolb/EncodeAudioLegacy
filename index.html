<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>EncodeAudioLegacy by martinsson</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>EncodeAudioLegacy</h1>
        <p>Practice GoldenMaster on legacy with hard to test dependencies</p>

        <p class="view"><a href="https://github.com/martinsson/EncodeAudioLegacy">View the Project on GitHub <small>martinsson/EncodeAudioLegacy</small></a></p>


        <ul>
          <li><a href="https://github.com/martinsson/EncodeAudioLegacy/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/martinsson/EncodeAudioLegacy/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/martinsson/EncodeAudioLegacy">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="instructions" class="anchor" href="#instructions"><span class="octicon octicon-link"></span></a>Instructions</h1>

<p>First use the setup instructions available in the README at the <a href="https://github.com/martinsson/EncodeAudioLegacy">base of the repo</a>
change between steps using changeStep.sh or nextStep.bat</p>

<h2 class="anchor">Requirements</h2>

<ul>
  <li>JDK 7.x</li>
  <li>Eclipse + EclEmma + m2e (or equivalent)</li>
  <li>Maven 3.x</li>
  <li>Diff-tool : for instance DiffMerge, WinMerge or Meld</li>
  <li>Git</li>
  <li>Internet/Wifi (for downloading maven dependencies)
    <ul>
      <li>Please do mvn clean compile beforehand</li>
    </ul>
  </li>
</ul>


<h2 class="anchor">Step 0: Check the tools</h3>
  Goal : validate your tools are working

  <p>Procedure</p>
  <ol>
  <li>build : mvn clean compile</li>
  <li>There's a unit test: checkJUnit().

  <ol>
  <li>It should fail.</li>
  <li>Fix it.</li>
  <li>It should pass</li>
  </ol>
  </li>
  <li>Run code coverage you should have 0%</li>
  <li>There's a unit test: checkApprovalTestsReporter().

  <ol>
  <li>Remove the @Ignore annotation</li>
  <li>It should open a window corresponding to your default diff tool</li>
  </ol>
  </li>
  </ol>


  <h3>Acceptance tests</h3>

    <ol>
    <li>I am able to build the project</li>
    <li>I can launch a unit test</li>
    <li>I can see the code coverage</li>
    <li>Approval Tests is able to launch a diff tool</li>
    </ol>
<h2><a name="step-1---string-comparison-using-approvaltests" class="anchor" href="#step-1---string-comparison-using-approvaltests"><span class="octicon octicon-link"></span></a>Step 1 - String comparison using ApprovalTests</h2>
  Goal: Get familiar with ApprovalTests
  <p>Bonus: find a way of covering the FileNotFoundException</p>

  <h3>Acceptance Test</h3>
  <p>You cover almost &gt; 95% of the code</p>

<h2><a name="step-2-coverage-by-input-parameter-variation" class="anchor" href="#step-2-coverage-by-input-parameter-variation"><span class="octicon octicon-link"></span></a>Step 2: Coverage by input parameter variation</h2>
  <p>Goal: cover as many branches as possible in CoreUtil using LegacyApprovals.lockdown()</p>
  <p>There are tests in place, replace all of them with one single test and a test helper method. By varying the inputs you should be able to cover all but one catch clause in CoreUtil.</p>
  <p> FYI, the InvocationTargetException you get from using LegacyApprovals is ApprovalTests way of saying that an exception was thrown by the method called by .lockdown(). You can improve the error message recorded by Approvals, by catching the exception generated by the code and returning e.getMessage() </p> 

  <h3><a name="hints" class="anchor" href="#hints"><span class="octicon octicon-link"></span></a>Hints</h3>
    <p>There are 3 arguments that vary</p>
    <p>there are files in src/test/resources that are used in the tests. You could add more of them, you could misspell a name.</p>

  <h3><a name="acceptance-tests" class="anchor" href="#acceptance-tests"><span class="octicon octicon-link"></span></a>Acceptance tests</h3>
    <ol>
    <li>There is only one test method</li>
    <li>All branches (except IOException in CoreUtil)  are covered</li>
    </ol>

<h2><a name="step-3---serializing-complex-type" class="anchor" href="#step-3---serializing-complex-type"><span class="octicon octicon-link"></span></a>Step 3 - Serializing a complex type</h2>
  Goal: Be able to compare a complex graph of nested objects
  <p>Use 'new XStream().toXml(someObject)' instead of 'someObject.toString()'</p>

  <h3>Acceptance Test</h3>
  <p>No use of IfluxTmlg.toString()</p>

<h2><a name="step-4---mocking-webservice" class="anchor" href="#step-4---mocking-webservice"><span class="octicon octicon-link"></span></a>Step 4 - Mocking a webservice</h2>
  Goal: Setup a webserver to serve a file
  <p>All tests are failing because the code now tries to download a file from an external webserver. Check the logs for the details of the missing file.
  <p>Configure Moco's 'server' object to respond with one of the source files in src/test/resources</p>

  <h3>Acceptance Test</h3>
  <p>The test passes without exception for atleast some of the combinations of input arguments</p>

<h2><a name="step-5---capture-side-effects" class="anchor" href="#step-5---capture-side-effects"><span class="octicon octicon-link"></span></a>Step 5 - Capturing side effects</h2>
  Goal: Capture the side effects and use them in the comparison
  <p>Files are encoded and saved to disk for access by 3rd party, capture for instance the names of all encoded files, append the file names to the result.
  The files are saved to the 'tmpDir' that is initialised in the test</p>

  <h3>Acceptance Test</h3>
  <p>Use both the result of the function call and the side effects for approving.</p>

</section>
<footer>
  <p>This project is maintained by <a href="https://github.com/martinsson">martinsson</a></p>
  <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
</footer>
</div>
<script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>